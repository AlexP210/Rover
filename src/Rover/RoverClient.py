# Echo server program
import socket
import select
import sys
import time
import matplotlib.pyplot as plt
import numpy as np

class RoverClient:
    def __init__(self):
        self.esp = socket.socket()
        self.port = 5000
        self.ip = "192.168.2.28"
        self.esp.connect((self.ip, self.port))
        self.esp.settimeout(0.0)

    def send(self, command):
        self.esp.send(command.encode())
        try: return self.esp.recv(1024).decode().strip()
        except BlockingIOError: return ":BLOCKING ERROR:"
        except UnicodeDecodeError: return ":DECODE ERROR:"


    
if __name__ == "__main__":
    client = RoverClient()
    # L = "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.51, 0.51, 0.51, 0.51, 0.51, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.86, 0.69, 2.06, 2.23, 2.23, 2.06, 2.06, 1.89, 2.23, 2.23, 2.92, 2.92, 2.92, 2.06, 2.92, 3.09, 3.09, 3.09, 1.54, 2.92, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.71, 1.54, 1.37, 1.54, 1.37, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.54, 1.37, 1.54, 1.71, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 2.92, 3.09, 3.43, 3.09, 3.43, 3.43, 3.43, 2.74, 3.43, 3.43, 2.57, 2.57, 2.57, 2.57, 2.74, 2.74, 2.74, 2.57, 2.57, 2.57, 2.57, 2.57, 0.86, 0.69, 0.69, 0.86, 0.69, 0.69, 0.69, 0.69, 0.86, 0.51, 0.69, 0.51, 0.51, 0.69, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.69, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.00, 0.00, 0.00, 0.00"
    # L = "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 1.37, 1.37, 1.37, 1.37, 1.37, 1.37, 1.37, 1.54, 1.37, 0.69, 0.86, 0.69, 0.69, 0.69, 0.69, 0.86, 0.69, 0.69, 0.69, 0.69, 0.86, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.51, 0.51, 0.34, 0.51, 0.51, 0.51, 0.69, 0.34, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.34, 0.51, 0.51, 0.51, 0.69, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.34, 0.51, 0.34, 0.51, 0.51, 0.51, 0.34, 0.51, 0.51, 0.34, 0.51, 0.69, 0.34, 0.51, 0.51, 0.34, 0.51, 0.51, 0.34, 0.51, 0.51, 0.34, 0.51, 0.69, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.34, 0.51, 0.51, 0.51, 0.69, 0.51, 0.51, 0.51, 0.51, 0.51, 0.34, 0.51, 0.51, 0.51, 0.51, 0.51, 0.34, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.51, 0.69, 0.51, 0.69, 0.69, 0.69, 0.86, 0.69, 0.69, 0.69, 0.69, 0.86, 0.69, 0.69, 0.69, 0.69, 0.86, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 0.69, 1.54, 1.71, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.54, 1.71, 1.54, 1.54, 1.71, 1.54, 1.54, 0.00, 0.00, 0.00, 0.00"
    # values = np.array([float(e) for e in L.split(", ") if e != 0])
    # angles = np.arange(0, 180)
    # plt.plot(values*np.cos(angles*3.14/180), values*np.sin(angles*3.14/180))
    # plt.show()
    while True:
        response = client.send(input("Enter Command: ") + "|")
        print("Reponse: " + response)